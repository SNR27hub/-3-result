<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="google-site-verification" content="BoXN-_xrR1h6w0XDyEKKTVQTRIRWDhRCx9jMS2QUaYA" />
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Developer SNR - Result Portal</title>
  <!-- Excel File Read karne ke liye Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #74ebd5, #acb6e5);
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
    }
    header {
      background: #4a00e0;
      color: white;
      padding: 25px;
      font-size: 32px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease;
      width: 100%;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      animation: fadeInScale 1s ease-out;
      position: fixed;
      top: 0;
      z-index: 1000;
    }
    header:hover {
      background: #8e2de2;
    }
    header img {
      width: 24px;
      height: 24px;
    }
    .container {
      margin: 120px auto 20px auto;
      width: 90%;
      max-width: 1000px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      animation: fadeIn 1.2s ease-out;
    }
    
    /* Tabs Design for Semester Switch */
    .tabs {
      display: flex;
      gap: 20px;
      margin-bottom: 25px;
      background: rgba(255, 255, 255, 0.3);
      padding: 10px;
      border-radius: 30px;
    }
    .tab-btn {
      padding: 12px 30px;
      border: none;
      border-radius: 25px;
      background: #fff;
      color: #4a00e0;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    .tab-btn.active {
      background: #4a00e0;
      color: white;
      transform: scale(1.1);
      box-shadow: 0 5px 15px rgba(74, 0, 224, 0.4);
    }
    
    input {
      padding: 15px;
      width: 350px;
      max-width: 90%;
      border-radius: 25px;
      border: none;
      outline: none;
      font-size: 18px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
      transition: transform 0.3s ease;
    }
    input:focus {
      transform: scale(1.02);
    }
    button.search-btn {
      padding: 15px 25px;
      margin: 10px;
      border: none;
      border-radius: 25px;
      background: #ff6f61;
      color: white;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
    }
    button.search-btn:hover {
      background: #ff3d2e;
      transform: scale(1.05);
      animation: pulse 0.5s infinite alternate;
    }
    .whatsapp-button {
      background: #25D366;
      margin-top: 15px;
      padding: 12px 20px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border-radius: 25px;
      color: white;
      text-decoration: none;
      font-weight: bold;
    }
    .whatsapp-button:hover {
      background: #20b358;
      transform: scale(1.05);
      animation: pulse 0.5s infinite alternate;
    }
    .whatsapp-button img {
      width: 24px;
      height: 24px;
    }
    .card {
      margin: 30px auto;
      padding: 30px;
      width: 90%;
      max-width: 800px;
      background: linear-gradient(135deg, #ffffff, #e6e6fa);
      border-radius: 20px;
      box-shadow: 0 15px 30px rgba(0,0,0,0.3), inset 0 0 10px rgba(255,255,255,0.5);
      position: relative;
      text-align: left;
      animation: slideIn 0.7s ease-out;
      border: 2px solid #ffd700;
    }
    .card h3 {
      margin: 10px 0;
      color: #2c3e50;
      font-size: 28px;
      display: flex;
      align-items: center;
    }
    .verified img {
      width: 24px;
      height: 24px;
      margin-left: 10px;
    }
    .card p {
      margin: 10px 0;
      color: #34495e;
      font-size: 18px;
    }
    .result-pass {
      color: #2ecc71;
      font-weight: bold;
    }
    .result-fail {
      color: #e74c3c;
      font-weight: bold;
    }
    .subject-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 15px;
      margin-top: 20px;
      padding: 15px;
      background: rgba(0,0,0,0.05);
      border-radius: 10px;
    }
    .subject-grid div {
      font-size: 16px;
      color: #34495e;
    }
    .subject-grid div:nth-child(odd) {
      font-weight: bold;
    }
    .watermark {
      position: absolute;
      bottom: 15px;
      right: 15px;
      opacity: 0.3;
      font-size: 32px;
      font-weight: bold;
      color: #4a00e0;
      transform: rotate(-15deg);
    }
    .notfound {
      color: #e74c3c;
      font-size: 20px;
      margin-top: 20px;
      animation: shake 0.3s ease;
      text-align: center;
      background: rgba(255,255,255,0.8);
      padding: 20px;
      border-radius: 10px;
    }
    .notice {
      margin-top: 20px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
      font-size: 16px;
      color: #34495e;
      text-align: center;
      max-width: 800px;
      width: 90%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .notice p {
      margin: 5px 0;
    }
    .notice .snr-text {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .notice .snr-text img {
      width: 20px;
      height: 20px;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeInScale { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.05); } }
  </style>
</head>
<body>
  <header onclick="window.open('https://www.instagram.com/snr__27?igsh=MXI4YXd5NnIxMDAzcw==', '_blank')">
    Developer SNR - Result Portal
    <a href="https://postimages.org/" target="_blank"><img src="https://i.postimg.cc/1zk15P0B/badge-18371637-1.png" border="0" alt="badge-18371637-1"/></a>
  </header>

  <div class="container">
    
    <!-- Tab Section -->
    <div class="tabs">
      <button class="tab-btn active" id="btn1" onclick="switchSemester(1)">1st Semester</button>
      <button class="tab-btn" id="btn2" onclick="switchSemester(2)">2nd Semester</button>
    </div>

    <h2 id="semTitle" style="color: #4a00e0; margin-top:0;">Search 1st Semester Result</h2>

    <input type="text" id="searchBox" placeholder="Enter Roll No. or Name">
    <button class="search-btn" onclick="searchResult()">Search</button>
    
    <div id="result"></div>
    
    <div class="notice">
      <p class="snr-text">This website is developed by a student. Developed by SNR <a href="https://postimages.org/" target="_blank"><img src="https://i.postimg.cc/1zk15P0B/badge-18371637-1.png" border="0" alt="badge-18371637-1"/></a></p>
      <p>Results are available for both +3 1st & 2nd Semester.</p>
      <p class="snr-text">ଏହି ୱେବସାଇଟ ଜଣେ ଛାତ୍ରଙ୍କ ଦ୍ୱାରା ବିକଶିତ। SNR ଦ୍ୱାରା ବିକଶିତ। <a href="https://postimages.org/" target="_blank"><img src="https://i.postimg.cc/1zk15P0B/badge-18371637-1.png" border="0" alt="badge-18371637-1"/></a></p>
      <p>ଉଭୟ +୩ ପ୍ରଥମ ଏବଂ ଦ୍ୱିତୀୟ ସେମିଷ୍ଟର ପାଇଁ ଫଳାଫଳ ଉପଲବ୍ଧ।</p>
    </div>
  </div>

  <script>
    let currentSemester = 1; // Default is 1st sem
    let studentsSem1 = [];
    let studentsSem2 = [];

    // Demo student for SNR
    const demoStudent = {
      roll: "Demo-SNR",
      name: "SNR",
      result: "Pass",
      percentage: "10",
      date: "December, 2024",
      college: "SNR College",
      subjects: {
        "EDN": ["A+"],
        "HIS": ["A+"],
        "PSC": ["A+"],
        "ODI": ["A+"],
        "ES": ["A+"],
        "GEN": ["A+"]
      }
    };

    // --- LOAD DATA START ---

    // 1. Load 1st Sem Data (Text File)
    fetch("data.txt")
      .then(res => res.text())
      .then(text => {
        studentsSem1 = parseDataSem1(text);
        console.log("Sem 1 Data Loaded");
      })
      .catch(err => console.error("Error loading Sem 1 data:", err));

    // 2. Load 2nd Sem Data (Excel File)
    // NOTE: File name must be exactly EGTR_2ND_SEM_NEP.xlsx
    fetch("EGTR_2ND_SEM_NEP.xlsx")
      .then(res => {
        if (!res.ok) throw new Error("Excel file not found");
        return res.arrayBuffer();
      })
      .then(data => {
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        
        // Convert Excel to JSON
        const jsonData = XLSX.utils.sheet_to_json(worksheet);
        studentsSem2 = parseDataSem2(jsonData);
        console.log("Sem 2 Data Loaded", studentsSem2.length);
      })
      .catch(err => {
        console.error("Error loading Sem 2 Excel:", err);
      });

    // --- PARSING FUNCTIONS ---

    // Parse Sem 1 Text
    function parseDataSem1(raw) {
      const lines = raw.split("\n").map(l => l.trim()).filter(l => l.length > 0);
      let data = [];
      lines.forEach(line => {
        let parts = line.split(/\s+/);
        let roll = parts[0].startsWith("N") ? parts[0] : "";
        let subjectStartIndex = parts.findIndex((p, i) => i >= (roll?2:0) && /^[A-Z]{2,3}$/.test(p));
        let name = parts.slice(roll?2:0, subjectStartIndex).join(" ").trim();
        
        let subjects = {};
        let i = subjectStartIndex;
        while (i < parts.length && /^[A-Z]{2,3}$/.test(parts[i])) {
          let subject = parts[i];
          let grade = parts[i + 1];
          if (!subjects[subject]) subjects[subject] = [];
          subjects[subject].push(grade);
          i += 2;
        }
        
        let percentage = "-";
        let match = line.match(/\d+\.\d+/);
        if (match) percentage = match[0];
        
        let result = line.includes("Pass") ? "Pass" : "Fail";
        let college = "";
        let idx = line.indexOf("175 -");
        if (idx !== -1) college = line.substring(idx + 5).replace(/Pass|Fail|December, 2024|\d+\.\d+/, "").trim();

        data.push({ roll, name, result, percentage, college, subjects, sem: 1 });
      });
      return data;
    }

    // Parse Sem 2 JSON (From Excel)
    function parseDataSem2(jsonData) {
      // Data ko clean aur standardize karte hain
      return jsonData.map(row => {
        // NOTE: Excel ke column names (Keys) yahan match hone chahiye
        // Agar aapke Excel me "Student Name" hai to row['Name'] ko row['Student Name'] karein
        
        // Dynamic key finder (Case insensitive try)
        const getKey = (key) => Object.keys(row).find(k => k.toLowerCase().includes(key.toLowerCase()));
        
        let name = row[getKey('Name')] || "Unknown";
        let roll = row[getKey('Roll')] || "N/A";
        let college = row[getKey('College')] || "SNR College";
        let result = row[getKey('Result')] || "-";
        let sgpa = row[getKey('SGPA')] || row[getKey('Point')] || "-";
        
        // Baki bache hue columns ko subjects maante hain (jo upar wale nahi hain)
        let subjects = {};
        Object.keys(row).forEach(key => {
            let lowerKey = key.toLowerCase();
            if(!lowerKey.includes('name') && !lowerKey.includes('roll') && !lowerKey.includes('college') && !lowerKey.includes('result') && !lowerKey.includes('sgpa')) {
                subjects[key] = [row[key]]; // Storing as array to match Sem 1 format
            }
        });

        return {
          roll: String(roll),
          name: String(name),
          result: result,
          percentage: sgpa, // Using SGPA/Points as percentage field for display
          college: college,
          subjects: subjects,
          sem: 2
        };
      });
    }

    // --- UI FUNCTIONS ---

    function switchSemester(sem) {
      currentSemester = sem;
      document.getElementById("btn1").classList.toggle("active", sem === 1);
      document.getElementById("btn2").classList.toggle("active", sem === 2);
      document.getElementById("semTitle").innerText = `Search ${sem === 1 ? '1st' : '2nd'} Semester Result`;
      document.getElementById("result").innerHTML = ""; // Clear previous results
      document.getElementById("searchBox").value = "";
    }

    function searchResult() {
      const query = document.getElementById("searchBox").value.trim().toLowerCase();
      if (!query) return;

      let resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "<p>Searching...</p>";

      let student;
      
      // Select correct data array
      let targetArray = currentSemester === 1 ? studentsSem1 : studentsSem2;

      // Special Check for Developer Demo
      if (query === "snr") {
        student = demoStudent;
      } else {
        student = targetArray.find(s => 
          String(s.roll).toLowerCase() === query || String(s.name).toLowerCase().includes(query)
        );
      }

      displayCard(student);
    }

    function displayCard(student) {
      let resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "";

      if (student) {
        // Prepare subject HTML
        let subjectHTML = "";
        for (let [subject, grades] of Object.entries(student.subjects)) {
          // Skip if grade is undefined or empty
          if(grades[0]) {
             subjectHTML += `<div>${subject}</div><div>${grades.join(", ")}</div>`;
          }
        }
        
        let resultClass = "";
        if(String(student.result).toLowerCase().includes("pass")) resultClass = "result-pass";
        else if(String(student.result).toLowerCase().includes("fail")) resultClass = "result-fail";

        let shareText = `Check your +3 ${currentSemester === 1 ? '1st' : '2nd'} Semester results at Developer SNR Result Portal: ${window.location.href}`;
        let whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(shareText)}`;

        resultDiv.innerHTML = `
          <div class="card">
            <h3>${student.name} <a href="#" class="verified"><img src="https://i.postimg.cc/1zk15P0B/badge-18371637-1.png" alt="verified"/></a></h3>
            <p><b>Roll No:</b> ${student.roll}</p>
            <p><b>College:</b> ${student.college}</p>
            <p><b>Total Points/SGPA:</b> ${student.percentage}</p>
            <p><b>Result:</b> <span class="${resultClass}">${student.result}</span></p>
            <div class="subject-grid">
              <div><b>Subject</b></div><div><b>Marks/Grade</b></div>
              ${subjectHTML}
            </div>
            <a href="${whatsappUrl}" target="_blank" class="whatsapp-button">
              <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
              Share Result
            </a>
            <div class="watermark">SNR</div>
          </div>
        `;
      } else {
        resultDiv.innerHTML = `
          <div class="notfound">
            ❌ Result not found in ${currentSemester === 1 ? '1st' : '2nd'} Semester.<br>
            Please check Roll No/Name or wait for update.<br>
            Note: For 2nd Sem, make sure 'EGTR_2ND_SEM_NEP.xlsx' is loaded.
          </div>
        `;
      }
    }
  </script>
</body>
</html>
